webpackJsonp([9],{"7Nko":function(n,t,e){var s=e("bWUe");"string"==typeof s&&(s=[[n.i,s,""]]),s.locals&&(n.exports=s.locals);e("rjj0")("40bd374b",s,!0,{})},Yid5:function(n,t,e){"use strict";function s(n){e("7Nko")}Object.defineProperty(t,"__esModule",{value:!0});var i=e("vLgD"),o=e("//Fk"),a=e.n(o),d=e("mvHQ"),r=e.n(d),c=e("Dd8w"),A=e.n(c),u=e("NYxO"),g={name:"chartMixin",data:function(){return{ws:null,otherImg:""}},computed:A()({},Object(u.b)({openid:function(n){return n.user.openid},selfImg:function(n){return n.user.infoObj.teaHeadimgurl||n.user.infoObj.stuHeadimgurl}})),mounted:function(){this.initWebsocket()},methods:{initWebsocket:function(){if(null===this.ws){var n="ws://47.93.225.12:8082/socketServer/"+this.openid;this.ws=new WebSocket(n),this.ws.onopen=this.websocketonopen,this.ws.onmessage=this.websocketonmessage,this.ws.onerror=this.websocketonerror,this.ws.onclose=this.websocketclose}},websocketonopen:function(){this.addGroup()},websocketonmessage:function(n){var t=JSON.parse(n.data);"SendToChatGroup"===t.opttype&&this.recSocketMsg(t),console.log(t)},websocketonerror:function(){this.initWebSocket()},websocketsend:function(n){this.ws.send(r()(n))},websocketclose:function(n){console.log("断开连接",n)},addGroup:function(){var n={addusername:this.openid,groupname:this.courseId,opttype:"CreateChatGroup",username:this.openid};this.websocketsend(n)},sendSocketMsg:function(n){var t={content:n,groupname:this.courseId,opttype:"SendToChatGroup",username:this.openid};this.websocketsend(t)},recSocketMsg:function(n){var t=this;console.log(n);var e=n.username===this.openid?"self":"other";console.log(e),new a.a(function(s){t.getInfo(n.username,e,s)}).then(function(){t.sendMsgFn(e,n.content)})},getInfo:function(n,t,e){"self"===t&&""===this.selfImg&&this._getImg(n,"self",e),"other"===t&&""===this.otherImg&&this._getImg(n,"other",e)},_getImg:function(n,t,e){var s=this;Object(i.a)({url:"http://www.zhiheyikaoqin.cn/user/queryUserInfo?openid="+n,method:"get"}).then(function(n){if(e(),0===Number(n.data.code)){var i=n.data.data;console.log("obj",i,t),s[t+"Img"]=i.stuHeadimgurl||i.teaHeadimgurl}},20)}}},b=e("X2Oc"),m={name:"chart",mixins:[g],data:function(){return{courseName:"",teaName:"",courseTime:"",chartList:[],sendMsg:"",courseId:"47",doingList:[],count:0,isEnd:!1}},computed:{btnDisabled:function(){return""===this.sendMsg},teaOpenid:function(){return this.$store.state.user.infoObj.teaOpenid||""},stuOpenid:function(){return this.$store.state.user.infoObj.stuOpenid||""},userType:function(){return this.$store.state.user.userType}},mounted:function(){this.getDoingList(),this.getCourseCount()},methods:{getCourseCount:function(){var n=this;Object(i.a)({url:"http://www.zhiheyikaoqin.cn/course/getCountDown?courseId="+this.courseId,method:"get"}).then(function(t){0===t.data.code&&("end"===t.data.data?n.showEnd():(n.count=Number(t.data.data),n.count=3,n.startCount()))})},checkEnd:function(){var n=this;Object(i.a)({url:"http://www.zhiheyikaoqin.cn/course/onCourseEnd?courseId="+this.courseId,method:"get"}).then(function(t){0===t.data.code&&(t.data.data=!0,n.isEnd=t.data.data,t.data.data?n.showEnd():(n.count=1,n.startCount()))})},startCount:function(){var n=this;setTimeout(function(){n.checkEnd()},1e3*this.count)},showEnd:function(){this.isEnd=!0,Object(b.b)(this,"课程已结束")},clickSend:function(){this.isEnd||(this.sendSocketMsg(this.sendMsg),this.sendMsgFn("self",this.sendMsg))},sendMsgFn:function(n,t){if(console.log("dd",n,t),""!==t){var e=(new Date).toTimeString().split(" ")[0];this.chartList.push({time:e,role:n,text:t}),this.$nextTick(function(){document.querySelector(".chart-list-scroll").scrollTop=999999}),"self"===n&&(this.sendMsg="")}},getTime:function(n){return n.split(" ")[1].split(":")[0]+":"+n.split(" ")[1].split(":")[1]},getDoingList:function(){var n=this,t="";"teacher"===this.userType?(t="http://www.zhiheyikaoqin.cn/tea/findTeaHistoryCourse",t+="?teaOpenid="+this.teaOpenid+"&page=1&pageSize=1000"):"student"===this.userType&&(t="http://www.zhiheyikaoqin.cn/stu/lookHistory",t+="?stuOpenid="+this.stuOpenid+"&page=1&pageSize=1000"),Object(i.a)({url:t,method:"get"}).then(function(t){n.loading=!1,0===t.data.code&&void 0!==t.data.data&&(n.doingList=t.data.data.filter(function(n){return 302===n.teaCourse.courseStatus}).map(function(t){return t.teaCourse.courseTime=t.teaCourse.courseDate.split(" ")[0]+" "+n.getTime(t.teaCourse.courseStartTime)+" - "+n.getTime(t.teaCourse.courseEndTime),t}),n.courseId=n.doingList[0].teaCourse.courseId,n.courseName=n.doingList[0].teaCourse.courseName,n.courseTime=n.doingList[0].teaCourse.courseTime,"student"===n.userType?n.teaName=n.doingList[0].teaName:n.teaName=n.doingList[0].teaBase.teaName)})}}},h=function(){var n=this,t=n.$createElement,e=n._self._c||t;return e("div",{staticClass:"doing-course"},[e("div",{staticClass:"course-info"},[e("div",{staticClass:"course-name"},[e("label",[n._v("课程名称：")]),n._v(" "),e("span",[n._v(n._s(n.courseName))])]),n._v(" "),e("div",{staticClass:"course-time"},[e("label",[n._v("课程时间：")]),n._v(" "),e("span",[n._v(n._s(n.courseTime))])]),n._v(" "),e("div",{staticClass:"course-time"},[e("label",[n._v("老师姓名：")]),n._v(" "),e("span",[n._v(n._s(n.teaName))])])]),n._v(" "),e("div",{staticClass:"chart-box"},[e("div",{staticClass:"chart-list-scroll"},[n._l(n.chartList,function(t){return 0!==n.chartList.length?e("div",{staticClass:"chart-list"},["self"===t.role?e("div",{staticClass:"msg-self msg-item"},[e("img",{staticClass:"user-icon",attrs:{src:n.selfImg}}),n._v(" "),e("div",{staticClass:"msg-content"},[e("div",{staticClass:"msg-text"},[n._v(n._s(t.text))]),n._v(" "),e("div",{staticClass:"msg-time"},[n._v(n._s(t.time))])])]):n._e(),n._v(" "),"other"===t.role?e("div",{staticClass:"msg-other msg-item"},[e("img",{staticClass:"user-icon",attrs:{src:n.otherImg}}),n._v(" "),e("div",{staticClass:"msg-content"},[e("div",{staticClass:"msg-text"},[n._v(n._s(t.text))]),n._v(" "),e("div",{staticClass:"msg-time"},[n._v(n._s(t.time))])])]):n._e()]):n._e()}),n._v(" "),0===n.chartList.length?e("div",{staticClass:"chart-list chart-empty"},[n._v("\n        暂无聊天记录\n      ")]):n._e()],2)]),n._v(" "),e("div",{staticClass:"send-msg"},[e("div",{staticClass:"send-box"},[e("input",{directives:[{name:"model",rawName:"v-model",value:n.sendMsg,expression:"sendMsg"}],attrs:{type:"text",disabled:n.isEnd},domProps:{value:n.sendMsg},on:{keyup:function(t){return"button"in t||!n._k(t.keyCode,"enter",13,t.key,"Enter")?n.clickSend(t):null},input:function(t){t.target.composing||(n.sendMsg=t.target.value)}}}),n._v(" "),e("div",{staticClass:"send-btn",class:{"btn-disabled":n.isEnd||n.btnDisabled},on:{click:function(t){return t.stopPropagation(),n.clickSend(t)}}},[n._v("发送")])])])])},l=[],p={render:h,staticRenderFns:l},C=p,f=e("VU/8"),B=s,v=f(m,C,!1,B,"data-v-b695b40c",null);t.default=v.exports},bWUe:function(n,t,e){t=n.exports=e("FZ+f")(!0),t.push([n.i,"\n.green[data-v-b695b40c] {\n  color: #03b349;\n}\n.doing-course[data-v-b695b40c] {\n  padding-bottom: 50px;\n}\n.course-info[data-v-b695b40c] {\n  line-height: 2;\n  margin: 10px 0;\n  background: #fff;\n  padding: 10px 20px;\n}\n.chart-box[data-v-b695b40c] {\n  height: calc(100% - 120px);\n  overflow: hidden;\n  line-height: 2;\n  margin: 10px 0 0 0;\n  padding: 10px 0 0 0;\n}\n.chart-list-scroll[data-v-b695b40c] {\n  padding: 0 20px;\n  height: 100%;\n  overflow: auto;\n}\n.chart-empty[data-v-b695b40c] {\n  color: #aaa;\n  padding: 80px 0;\n  text-align: center;\n}\n.msg-item[data-v-b695b40c] {\n  position: relative;\n  margin-bottom: 14px;\n}\n.msg-item .user-icon[data-v-b695b40c] {\n    position: absolute;\n    width: 30px;\n    height: 30px;\n    border: 2px solid #03b349;\n    border-radius: 40px;\n}\n.msg-item .msg-time[data-v-b695b40c] {\n    line-height: 1.3;\n    color: #aaa;\n}\n.msg-item .msg-text[data-v-b695b40c] {\n    min-height: 26px;\n    display: inline-block;\n    background: #fff;\n    border: 1px solid #03b349;\n    border-radius: 5px;\n    padding: 0 20px;\n    max-width: 100%;\n    word-break: break-all;\n    text-align: left;\n}\n.msg-item.msg-self .user-icon[data-v-b695b40c] {\n    right: 0;\n}\n.msg-item.msg-self .msg-content[data-v-b695b40c] {\n    padding-right: 50px;\n    text-align: right;\n}\n.msg-item.msg-other .user-icon[data-v-b695b40c] {\n    left: 0;\n}\n.msg-item.msg-other .msg-content[data-v-b695b40c] {\n    padding-left: 50px;\n}\n.send-msg[data-v-b695b40c] {\n  position: fixed;\n  bottom: 0;\n  width: 100%;\n  line-height: 2;\n  background: #fbf9fe;\n  padding: 0 0 6px 0;\n}\n.send-msg .send-box[data-v-b695b40c] {\n    border: 1px solid #eaeaea;\n    border-width: 1px 0;\n    background: #fff;\n    height: 40px;\n    position: relative;\n}\n.send-msg input[data-v-b695b40c] {\n    height: 40px;\n    width: calc(100% - 80px);\n    font-size: 14px;\n    padding: 0 70px 0 10px;\n    outline: 0;\n    border: 0;\n}\n.send-msg .send-btn[data-v-b695b40c] {\n    background: #03b349;\n    position: absolute;\n    top: 0;\n    right: 10px;\n    color: #fff;\n    padding: 0px 10px;\n    margin: 8px 0;\n    border-radius: 5px;\n}\n.send-msg .send-btn.btn-disabled[data-v-b695b40c] {\n      background: #eee;\n      color: #aaa;\n}\n","",{version:3,sources:["/Users/lh/work/zk/fe/src/chart/index.vue"],names:[],mappings:";AACA;EACE,eAAe;CAChB;AACD;EACE,qBAAqB;CACtB;AACD;EACE,eAAe;EACf,eAAe;EACf,iBAAiB;EACjB,mBAAmB;CACpB;AACD;EACE,2BAA2B;EAC3B,iBAAiB;EACjB,eAAe;EACf,mBAAmB;EACnB,oBAAoB;CACrB;AACD;EACE,gBAAgB;EAChB,aAAa;EACb,eAAe;CAChB;AACD;EACE,YAAY;EACZ,gBAAgB;EAChB,mBAAmB;CACpB;AACD;EACE,mBAAmB;EACnB,oBAAoB;CACrB;AACD;IACI,mBAAmB;IACnB,YAAY;IACZ,aAAa;IACb,0BAA0B;IAC1B,oBAAoB;CACvB;AACD;IACI,iBAAiB;IACjB,YAAY;CACf;AACD;IACI,iBAAiB;IACjB,sBAAsB;IACtB,iBAAiB;IACjB,0BAA0B;IAC1B,mBAAmB;IACnB,gBAAgB;IAChB,gBAAgB;IAChB,sBAAsB;IACtB,iBAAiB;CACpB;AACD;IACI,SAAS;CACZ;AACD;IACI,oBAAoB;IACpB,kBAAkB;CACrB;AACD;IACI,QAAQ;CACX;AACD;IACI,mBAAmB;CACtB;AACD;EACE,gBAAgB;EAChB,UAAU;EACV,YAAY;EACZ,eAAe;EACf,oBAAoB;EACpB,mBAAmB;CACpB;AACD;IACI,0BAA0B;IAC1B,oBAAoB;IACpB,iBAAiB;IACjB,aAAa;IACb,mBAAmB;CACtB;AACD;IACI,aAAa;IACb,yBAAyB;IACzB,gBAAgB;IAChB,uBAAuB;IACvB,WAAW;IACX,UAAU;CACb;AACD;IACI,oBAAoB;IACpB,mBAAmB;IACnB,OAAO;IACP,YAAY;IACZ,YAAY;IACZ,kBAAkB;IAClB,cAAc;IACd,mBAAmB;CACtB;AACD;MACM,iBAAiB;MACjB,YAAY;CACjB",file:"index.vue",sourcesContent:["\n.green[data-v-b695b40c] {\n  color: #03b349;\n}\n.doing-course[data-v-b695b40c] {\n  padding-bottom: 50px;\n}\n.course-info[data-v-b695b40c] {\n  line-height: 2;\n  margin: 10px 0;\n  background: #fff;\n  padding: 10px 20px;\n}\n.chart-box[data-v-b695b40c] {\n  height: calc(100% - 120px);\n  overflow: hidden;\n  line-height: 2;\n  margin: 10px 0 0 0;\n  padding: 10px 0 0 0;\n}\n.chart-list-scroll[data-v-b695b40c] {\n  padding: 0 20px;\n  height: 100%;\n  overflow: auto;\n}\n.chart-empty[data-v-b695b40c] {\n  color: #aaa;\n  padding: 80px 0;\n  text-align: center;\n}\n.msg-item[data-v-b695b40c] {\n  position: relative;\n  margin-bottom: 14px;\n}\n.msg-item .user-icon[data-v-b695b40c] {\n    position: absolute;\n    width: 30px;\n    height: 30px;\n    border: 2px solid #03b349;\n    border-radius: 40px;\n}\n.msg-item .msg-time[data-v-b695b40c] {\n    line-height: 1.3;\n    color: #aaa;\n}\n.msg-item .msg-text[data-v-b695b40c] {\n    min-height: 26px;\n    display: inline-block;\n    background: #fff;\n    border: 1px solid #03b349;\n    border-radius: 5px;\n    padding: 0 20px;\n    max-width: 100%;\n    word-break: break-all;\n    text-align: left;\n}\n.msg-item.msg-self .user-icon[data-v-b695b40c] {\n    right: 0;\n}\n.msg-item.msg-self .msg-content[data-v-b695b40c] {\n    padding-right: 50px;\n    text-align: right;\n}\n.msg-item.msg-other .user-icon[data-v-b695b40c] {\n    left: 0;\n}\n.msg-item.msg-other .msg-content[data-v-b695b40c] {\n    padding-left: 50px;\n}\n.send-msg[data-v-b695b40c] {\n  position: fixed;\n  bottom: 0;\n  width: 100%;\n  line-height: 2;\n  background: #fbf9fe;\n  padding: 0 0 6px 0;\n}\n.send-msg .send-box[data-v-b695b40c] {\n    border: 1px solid #eaeaea;\n    border-width: 1px 0;\n    background: #fff;\n    height: 40px;\n    position: relative;\n}\n.send-msg input[data-v-b695b40c] {\n    height: 40px;\n    width: calc(100% - 80px);\n    font-size: 14px;\n    padding: 0 70px 0 10px;\n    outline: 0;\n    border: 0;\n}\n.send-msg .send-btn[data-v-b695b40c] {\n    background: #03b349;\n    position: absolute;\n    top: 0;\n    right: 10px;\n    color: #fff;\n    padding: 0px 10px;\n    margin: 8px 0;\n    border-radius: 5px;\n}\n.send-msg .send-btn.btn-disabled[data-v-b695b40c] {\n      background: #eee;\n      color: #aaa;\n}\n"],sourceRoot:""}])}});
//# sourceMappingURL=9.51d4e2a149586a00d237.js.map