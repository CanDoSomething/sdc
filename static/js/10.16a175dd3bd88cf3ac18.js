webpackJsonp([10],{"32eQ":function(n,t,e){t=n.exports=e("FZ+f")(!0),t.push([n.i,"\n.green[data-v-5384973a] {\n  color: #03b349;\n}\n.doing-course[data-v-5384973a] {\n  padding-bottom: 50px;\n}\n.course-info[data-v-5384973a] {\n  line-height: 2;\n  margin: 10px 0;\n  background: #fff;\n  padding: 10px 20px;\n}\n.chart-box[data-v-5384973a] {\n  height: calc(100% - 120px);\n  overflow: hidden;\n  line-height: 2;\n  margin: 10px 0 0 0;\n  padding: 10px 0 0 0;\n}\n.chart-list-scroll[data-v-5384973a] {\n  padding: 0 20px;\n  height: 100%;\n  overflow: auto;\n}\n.chart-empty[data-v-5384973a] {\n  color: #aaa;\n  padding: 80px 0;\n  text-align: center;\n}\n.msg-item[data-v-5384973a] {\n  position: relative;\n  margin-bottom: 14px;\n}\n.msg-item .user-icon[data-v-5384973a] {\n    position: absolute;\n    width: 30px;\n    height: 30px;\n    border: 2px solid #03b349;\n    border-radius: 40px;\n}\n.msg-item .msg-time[data-v-5384973a] {\n    line-height: 1.3;\n    color: #aaa;\n}\n.msg-item .msg-text[data-v-5384973a] {\n    min-height: 26px;\n    display: inline-block;\n    background: #fff;\n    border: 1px solid #03b349;\n    border-radius: 5px;\n    padding: 0 20px;\n    max-width: 100%;\n    word-break: break-all;\n    text-align: left;\n}\n.msg-item.msg-self .user-icon[data-v-5384973a] {\n    right: 0;\n}\n.msg-item.msg-self .msg-content[data-v-5384973a] {\n    padding-right: 50px;\n    text-align: right;\n}\n.msg-item.msg-other .user-icon[data-v-5384973a] {\n    left: 0;\n}\n.msg-item.msg-other .msg-content[data-v-5384973a] {\n    padding-left: 50px;\n}\n.send-msg[data-v-5384973a] {\n  position: fixed;\n  bottom: 0;\n  width: 100%;\n  line-height: 2;\n  background: #fbf9fe;\n  padding: 0 0 6px 0;\n}\n.send-msg .send-box[data-v-5384973a] {\n    border: 1px solid #eaeaea;\n    border-width: 1px 0;\n    background: #fff;\n    height: 40px;\n    position: relative;\n}\n.send-msg input[data-v-5384973a] {\n    height: 40px;\n    width: calc(100% - 80px);\n    font-size: 14px;\n    padding: 0 70px 0 10px;\n    outline: 0;\n    border: 0;\n}\n.send-msg .send-btn[data-v-5384973a] {\n    background: #03b349;\n    position: absolute;\n    top: 0;\n    right: 10px;\n    color: #fff;\n    padding: 0px 10px;\n    margin: 8px 0;\n    border-radius: 5px;\n}\n.send-msg .send-btn.btn-disabled[data-v-5384973a] {\n      background: #eee;\n      color: #aaa;\n}\n","",{version:3,sources:["/Users/lh/work/zk/fe/src/chart/index.vue"],names:[],mappings:";AACA;EACE,eAAe;CAChB;AACD;EACE,qBAAqB;CACtB;AACD;EACE,eAAe;EACf,eAAe;EACf,iBAAiB;EACjB,mBAAmB;CACpB;AACD;EACE,2BAA2B;EAC3B,iBAAiB;EACjB,eAAe;EACf,mBAAmB;EACnB,oBAAoB;CACrB;AACD;EACE,gBAAgB;EAChB,aAAa;EACb,eAAe;CAChB;AACD;EACE,YAAY;EACZ,gBAAgB;EAChB,mBAAmB;CACpB;AACD;EACE,mBAAmB;EACnB,oBAAoB;CACrB;AACD;IACI,mBAAmB;IACnB,YAAY;IACZ,aAAa;IACb,0BAA0B;IAC1B,oBAAoB;CACvB;AACD;IACI,iBAAiB;IACjB,YAAY;CACf;AACD;IACI,iBAAiB;IACjB,sBAAsB;IACtB,iBAAiB;IACjB,0BAA0B;IAC1B,mBAAmB;IACnB,gBAAgB;IAChB,gBAAgB;IAChB,sBAAsB;IACtB,iBAAiB;CACpB;AACD;IACI,SAAS;CACZ;AACD;IACI,oBAAoB;IACpB,kBAAkB;CACrB;AACD;IACI,QAAQ;CACX;AACD;IACI,mBAAmB;CACtB;AACD;EACE,gBAAgB;EAChB,UAAU;EACV,YAAY;EACZ,eAAe;EACf,oBAAoB;EACpB,mBAAmB;CACpB;AACD;IACI,0BAA0B;IAC1B,oBAAoB;IACpB,iBAAiB;IACjB,aAAa;IACb,mBAAmB;CACtB;AACD;IACI,aAAa;IACb,yBAAyB;IACzB,gBAAgB;IAChB,uBAAuB;IACvB,WAAW;IACX,UAAU;CACb;AACD;IACI,oBAAoB;IACpB,mBAAmB;IACnB,OAAO;IACP,YAAY;IACZ,YAAY;IACZ,kBAAkB;IAClB,cAAc;IACd,mBAAmB;CACtB;AACD;MACM,iBAAiB;MACjB,YAAY;CACjB",file:"index.vue",sourcesContent:["\n.green[data-v-5384973a] {\n  color: #03b349;\n}\n.doing-course[data-v-5384973a] {\n  padding-bottom: 50px;\n}\n.course-info[data-v-5384973a] {\n  line-height: 2;\n  margin: 10px 0;\n  background: #fff;\n  padding: 10px 20px;\n}\n.chart-box[data-v-5384973a] {\n  height: calc(100% - 120px);\n  overflow: hidden;\n  line-height: 2;\n  margin: 10px 0 0 0;\n  padding: 10px 0 0 0;\n}\n.chart-list-scroll[data-v-5384973a] {\n  padding: 0 20px;\n  height: 100%;\n  overflow: auto;\n}\n.chart-empty[data-v-5384973a] {\n  color: #aaa;\n  padding: 80px 0;\n  text-align: center;\n}\n.msg-item[data-v-5384973a] {\n  position: relative;\n  margin-bottom: 14px;\n}\n.msg-item .user-icon[data-v-5384973a] {\n    position: absolute;\n    width: 30px;\n    height: 30px;\n    border: 2px solid #03b349;\n    border-radius: 40px;\n}\n.msg-item .msg-time[data-v-5384973a] {\n    line-height: 1.3;\n    color: #aaa;\n}\n.msg-item .msg-text[data-v-5384973a] {\n    min-height: 26px;\n    display: inline-block;\n    background: #fff;\n    border: 1px solid #03b349;\n    border-radius: 5px;\n    padding: 0 20px;\n    max-width: 100%;\n    word-break: break-all;\n    text-align: left;\n}\n.msg-item.msg-self .user-icon[data-v-5384973a] {\n    right: 0;\n}\n.msg-item.msg-self .msg-content[data-v-5384973a] {\n    padding-right: 50px;\n    text-align: right;\n}\n.msg-item.msg-other .user-icon[data-v-5384973a] {\n    left: 0;\n}\n.msg-item.msg-other .msg-content[data-v-5384973a] {\n    padding-left: 50px;\n}\n.send-msg[data-v-5384973a] {\n  position: fixed;\n  bottom: 0;\n  width: 100%;\n  line-height: 2;\n  background: #fbf9fe;\n  padding: 0 0 6px 0;\n}\n.send-msg .send-box[data-v-5384973a] {\n    border: 1px solid #eaeaea;\n    border-width: 1px 0;\n    background: #fff;\n    height: 40px;\n    position: relative;\n}\n.send-msg input[data-v-5384973a] {\n    height: 40px;\n    width: calc(100% - 80px);\n    font-size: 14px;\n    padding: 0 70px 0 10px;\n    outline: 0;\n    border: 0;\n}\n.send-msg .send-btn[data-v-5384973a] {\n    background: #03b349;\n    position: absolute;\n    top: 0;\n    right: 10px;\n    color: #fff;\n    padding: 0px 10px;\n    margin: 8px 0;\n    border-radius: 5px;\n}\n.send-msg .send-btn.btn-disabled[data-v-5384973a] {\n      background: #eee;\n      color: #aaa;\n}\n"],sourceRoot:""}])},"7qIL":function(n,t,e){var s=e("32eQ");"string"==typeof s&&(s=[[n.i,s,""]]),s.locals&&(n.exports=s.locals);e("rjj0")("98e2c1cc",s,!0,{})},Yid5:function(n,t,e){"use strict";function s(n){e("7qIL")}Object.defineProperty(t,"__esModule",{value:!0});var i=e("vLgD"),a=e("//Fk"),o=e.n(a),d=e("mvHQ"),r=e.n(d),c=e("Dd8w"),A=e.n(c),g=e("NYxO"),u={name:"chartMixin",data:function(){return{ws:null,otherImg:""}},computed:A()({},Object(g.b)({openid:function(n){return n.user.openid},selfImg:function(n){return n.user.infoObj.teaHeadimgurl||n.user.infoObj.stuHeadimgurl}})),mounted:function(){this.initWebsocket()},watch:{courseId:function(){this.initWebsocket()}},methods:{initWebsocket:function(){if(null===this.ws&&""!==this.courseId){var n="ws://47.93.225.12:8082/socketServer/"+this.openid;this.ws=new WebSocket(n),this.ws.onopen=this.websocketonopen,this.ws.onmessage=this.websocketonmessage,this.ws.onerror=this.websocketonerror,this.ws.onclose=this.websocketclose}},websocketonopen:function(){this.addGroup()},websocketonmessage:function(n){var t=JSON.parse(n.data);"SendToChatGroup"===t.opttype&&this.recSocketMsg(t),console.log(t)},websocketonerror:function(){this.initWebSocket()},websocketsend:function(n){this.ws.send(r()(n))},websocketclose:function(n){console.log("断开连接",n)},addGroup:function(){var n={addusername:this.openid,groupname:this.courseId,opttype:"CreateChatGroup",username:this.openid};this.websocketsend(n)},sendSocketMsg:function(n){var t={content:n,groupname:this.courseId,opttype:"SendToChatGroup",username:this.openid};this.websocketsend(t)},recSocketMsg:function(n){var t=this;console.log(n);var e=n.username===this.openid?"self":"other";console.log(e),new o.a(function(s){t.getInfo(n.username,e,s)}).then(function(){t.sendMsgFn(e,n.content)})},getInfo:function(n,t,e){"self"===t&&""===this.selfImg&&this._getImg(n,"self",e),"other"===t&&""===this.otherImg&&this._getImg(n,"other",e)},_getImg:function(n,t,e){var s=this;Object(i.a)({url:"http://www.zhiheyikaoqin.cn/user/queryUserInfo?openid="+n,method:"get"}).then(function(n){if(e(),0===Number(n.data.code)){var i=n.data.data;console.log("obj",i,t),s[t+"Img"]=i.stuHeadimgurl||i.teaHeadimgurl}},20)}}},l=e("X2Oc"),h=e("8pLc"),m=e("KgXo"),p=(h.a,m.a,{name:"chart",components:{noData:h.a,loading:m.a},mixins:[u],data:function(){return{loading:!0,noCourse:!1,courseName:"",teaName:"",courseTime:"",chartList:[],sendMsg:"",courseId:"",doingList:[],count:0,isEnd:!1}},computed:{btnDisabled:function(){return""===this.sendMsg},teaOpenid:function(){return this.$store.state.user.infoObj.teaOpenid||""},stuOpenid:function(){return this.$store.state.user.infoObj.stuOpenid||""},userType:function(){return this.$store.state.user.userType}},mounted:function(){this.$store.commit("SET_RETURN_TEXT","在线交流"),this.$store.commit("SET_RETURN_URL","/my"),this.getDoingList()},watch:{userType:function(){this.getDoingList()}},methods:{getCourseCount:function(){var n=this;Object(i.a)({url:"http://www.zhiheyikaoqin.cn/course/getCountDown?courseId="+this.courseId,method:"get"}).then(function(t){0===t.data.code&&("end"===t.data.data?n.showEnd():(n.count=Number(t.data.data),n.startCount()))})},checkEnd:function(){var n=this;Object(i.a)({url:"http://www.zhiheyikaoqin.cn/course/onCourseEnd?courseId="+this.courseId,method:"get"}).then(function(t){0===t.data.code&&(t.data.data=!0,n.isEnd=t.data.data,t.data.data?n.showEnd():n.startCount())})},startCount:function(){var n=this;setTimeout(function(){n.checkEnd()},1e3*this.count)},showEnd:function(){this.isEnd=!0,Object(l.b)(this,"课程已结束")},clickSend:function(){this.isEnd||(this.sendSocketMsg(this.sendMsg),this.sendMsgFn("self",this.sendMsg))},sendMsgFn:function(n,t){if(console.log("dd",n,t),""!==t){var e=(new Date).toTimeString().split(" ")[0];this.chartList.push({time:e,role:n,text:t}),this.$nextTick(function(){document.querySelector(".chart-list-scroll").scrollTop=999999}),"self"===n&&(this.sendMsg="")}},getTime:function(n){return n.split(" ")[1].split(":")[0]+":"+n.split(" ")[1].split(":")[1]},getDoingList:function(){var n=this;this.loading=!0;var t="";"teacher"===this.userType?(t="http://www.zhiheyikaoqin.cn/tea/findTeaHistoryCourse",t+="?teaOpenid="+this.teaOpenid+"&page=1&pageSize=1000"):"student"===this.userType&&(t="http://www.zhiheyikaoqin.cn/stu/lookHistory",t+="?stuOpenid="+this.stuOpenid+"&page=1&pageSize=1000"),console.log("dd",t),Object(i.a)({url:t,method:"get"}).then(function(t){console.log("sss",t),n.loading=!1,0===t.data.code&&void 0!==t.data.data?(n.doingList=t.data.data.filter(function(n){return 302===n.teaCourse.courseStatus}).map(function(t){return t.teaCourse.courseTime=t.teaCourse.courseDate.split(" ")[0]+" "+n.getTime(t.teaCourse.courseStartTime)+" - "+n.getTime(t.teaCourse.courseEndTime),t}),0===n.doingList.length?n.noCourse=!0:(n.courseId=n.doingList[0].teaCourse.courseId,n.courseName=n.doingList[0].teaCourse.courseName,n.courseTime=n.doingList[0].teaCourse.courseTime,"student"===n.userType?n.teaName=n.doingList[0].teaName:n.teaName=n.doingList[0].teaBase.teaName,n.noCourse=!1,n.getCourseCount())):n.noCourse=!0})}}}),C=function(){var n=this,t=n.$createElement,e=n._self._c||t;return e("div",{staticClass:"doing-course"},[!n.loading&&n.noCourse?e("div",{staticClass:"no-course"},[e("no-data",{attrs:{text:"当前没有正在上的课"}})],1):n._e(),n._v(" "),n.loading||n.noCourse?n._e():e("div",{staticClass:"course-info"},[e("div",{staticClass:"course-name"},[e("label",[n._v("课程名称：")]),n._v(" "),e("span",[n._v(n._s(n.courseName))])]),n._v(" "),e("div",{staticClass:"course-time"},[e("label",[n._v("课程时间：")]),n._v(" "),e("span",[n._v(n._s(n.courseTime))])]),n._v(" "),e("div",{staticClass:"course-time"},[e("label",[n._v("老师姓名：")]),n._v(" "),e("span",[n._v(n._s(n.teaName))])])]),n._v(" "),n.loading||n.noCourse?n._e():e("div",{staticClass:"chart-box"},[e("div",{staticClass:"chart-list-scroll"},[n._l(n.chartList,function(t){return 0!==n.chartList.length?e("div",{staticClass:"chart-list"},["self"===t.role?e("div",{staticClass:"msg-self msg-item"},[e("img",{staticClass:"user-icon",attrs:{src:n.selfImg}}),n._v(" "),e("div",{staticClass:"msg-content"},[e("div",{staticClass:"msg-text"},[n._v(n._s(t.text))]),n._v(" "),e("div",{staticClass:"msg-time"},[n._v(n._s(t.time))])])]):n._e(),n._v(" "),"other"===t.role?e("div",{staticClass:"msg-other msg-item"},[e("img",{staticClass:"user-icon",attrs:{src:n.otherImg}}),n._v(" "),e("div",{staticClass:"msg-content"},[e("div",{staticClass:"msg-text"},[n._v(n._s(t.text))]),n._v(" "),e("div",{staticClass:"msg-time"},[n._v(n._s(t.time))])])]):n._e()]):n._e()}),n._v(" "),0===n.chartList.length?e("div",{staticClass:"chart-list chart-empty"},[n._v("\n        暂无聊天记录\n      ")]):n._e()],2)]),n._v(" "),n.loading||n.noCourse?n._e():e("div",{staticClass:"send-msg"},[e("div",{staticClass:"send-box"},[e("input",{directives:[{name:"model",rawName:"v-model",value:n.sendMsg,expression:"sendMsg"}],attrs:{type:"text",disabled:n.isEnd},domProps:{value:n.sendMsg},on:{keyup:function(t){return"button"in t||!n._k(t.keyCode,"enter",13,t.key,"Enter")?n.clickSend(t):null},input:function(t){t.target.composing||(n.sendMsg=t.target.value)}}}),n._v(" "),e("div",{staticClass:"send-btn",class:{"btn-disabled":n.isEnd||n.btnDisabled},on:{click:function(t){return t.stopPropagation(),n.clickSend(t)}}},[n._v("发送")])])]),n._v(" "),n.loading?[e("loading")]:n._e()],2)},f=[],B={render:C,staticRenderFns:f},v=B,b=e("VU/8"),x=s,I=b(p,v,!1,x,"data-v-5384973a",null);t.default=I.exports}});
//# sourceMappingURL=10.16a175dd3bd88cf3ac18.js.map