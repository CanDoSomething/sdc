webpackJsonp([12],{"DaP+":function(t,n,e){n=t.exports=e("FZ+f")(!0),n.push([t.i,"\n.green[data-v-3a6161b3] {\n  color: #03b349;\n}\n.doing-course[data-v-3a6161b3] {\n  padding-bottom: 50px;\n}\n.course-info[data-v-3a6161b3] {\n  line-height: 2;\n  margin: 10px 0;\n  background: #fff;\n  padding: 10px 20px;\n}\n.chart-box[data-v-3a6161b3] {\n  height: calc(100% - 120px);\n  overflow: hidden;\n  line-height: 2;\n  margin: 10px 0 0 0;\n  padding: 10px 0 0 0;\n}\n.chart-list-scroll[data-v-3a6161b3] {\n  padding: 0 20px;\n  height: 100%;\n  overflow: auto;\n}\n.chart-empty[data-v-3a6161b3] {\n  color: #aaa;\n  padding: 80px 0;\n  text-align: center;\n}\n.msg-item[data-v-3a6161b3] {\n  position: relative;\n  margin-bottom: 14px;\n}\n.msg-item .user-icon[data-v-3a6161b3] {\n    position: absolute;\n    width: 30px;\n    height: 30px;\n    border: 2px solid #03b349;\n    border-radius: 40px;\n}\n.msg-item .msg-time[data-v-3a6161b3] {\n    line-height: 1.3;\n    color: #aaa;\n}\n.msg-item .msg-text[data-v-3a6161b3] {\n    min-height: 26px;\n    display: inline-block;\n    background: #fff;\n    border: 1px solid #03b349;\n    border-radius: 5px;\n    padding: 0 20px;\n    max-width: 100%;\n    word-break: break-all;\n    text-align: left;\n}\n.msg-item.msg-self .user-icon[data-v-3a6161b3] {\n    right: 0;\n}\n.msg-item.msg-self .msg-content[data-v-3a6161b3] {\n    padding-right: 50px;\n    text-align: right;\n}\n.msg-item.msg-other .user-icon[data-v-3a6161b3] {\n    left: 0;\n}\n.msg-item.msg-other .msg-content[data-v-3a6161b3] {\n    padding-left: 50px;\n}\n.send-msg[data-v-3a6161b3] {\n  position: fixed;\n  bottom: 0;\n  width: 100%;\n  line-height: 2;\n  background: #fbf9fe;\n  padding: 0 0 6px 0;\n}\n.send-msg .send-box[data-v-3a6161b3] {\n    border: 1px solid #eaeaea;\n    border-width: 1px 0;\n    background: #fff;\n    height: 40px;\n    position: relative;\n}\n.send-msg input[data-v-3a6161b3] {\n    height: 40px;\n    width: calc(100% - 80px);\n    font-size: 14px;\n    padding: 0 70px 0 10px;\n    outline: 0;\n    border: 0;\n}\n.send-msg .send-btn[data-v-3a6161b3] {\n    background: #03b349;\n    position: absolute;\n    top: 0;\n    right: 10px;\n    color: #fff;\n    padding: 0px 10px;\n    margin: 8px 0;\n    border-radius: 5px;\n}\n.send-msg .send-btn.btn-disabled[data-v-3a6161b3] {\n      background: #eee;\n      color: #aaa;\n}\n","",{version:3,sources:["/Users/lh/work/zk/fe/src/chart/index.vue"],names:[],mappings:";AACA;EACE,eAAe;CAChB;AACD;EACE,qBAAqB;CACtB;AACD;EACE,eAAe;EACf,eAAe;EACf,iBAAiB;EACjB,mBAAmB;CACpB;AACD;EACE,2BAA2B;EAC3B,iBAAiB;EACjB,eAAe;EACf,mBAAmB;EACnB,oBAAoB;CACrB;AACD;EACE,gBAAgB;EAChB,aAAa;EACb,eAAe;CAChB;AACD;EACE,YAAY;EACZ,gBAAgB;EAChB,mBAAmB;CACpB;AACD;EACE,mBAAmB;EACnB,oBAAoB;CACrB;AACD;IACI,mBAAmB;IACnB,YAAY;IACZ,aAAa;IACb,0BAA0B;IAC1B,oBAAoB;CACvB;AACD;IACI,iBAAiB;IACjB,YAAY;CACf;AACD;IACI,iBAAiB;IACjB,sBAAsB;IACtB,iBAAiB;IACjB,0BAA0B;IAC1B,mBAAmB;IACnB,gBAAgB;IAChB,gBAAgB;IAChB,sBAAsB;IACtB,iBAAiB;CACpB;AACD;IACI,SAAS;CACZ;AACD;IACI,oBAAoB;IACpB,kBAAkB;CACrB;AACD;IACI,QAAQ;CACX;AACD;IACI,mBAAmB;CACtB;AACD;EACE,gBAAgB;EAChB,UAAU;EACV,YAAY;EACZ,eAAe;EACf,oBAAoB;EACpB,mBAAmB;CACpB;AACD;IACI,0BAA0B;IAC1B,oBAAoB;IACpB,iBAAiB;IACjB,aAAa;IACb,mBAAmB;CACtB;AACD;IACI,aAAa;IACb,yBAAyB;IACzB,gBAAgB;IAChB,uBAAuB;IACvB,WAAW;IACX,UAAU;CACb;AACD;IACI,oBAAoB;IACpB,mBAAmB;IACnB,OAAO;IACP,YAAY;IACZ,YAAY;IACZ,kBAAkB;IAClB,cAAc;IACd,mBAAmB;CACtB;AACD;MACM,iBAAiB;MACjB,YAAY;CACjB",file:"index.vue",sourcesContent:["\n.green[data-v-3a6161b3] {\n  color: #03b349;\n}\n.doing-course[data-v-3a6161b3] {\n  padding-bottom: 50px;\n}\n.course-info[data-v-3a6161b3] {\n  line-height: 2;\n  margin: 10px 0;\n  background: #fff;\n  padding: 10px 20px;\n}\n.chart-box[data-v-3a6161b3] {\n  height: calc(100% - 120px);\n  overflow: hidden;\n  line-height: 2;\n  margin: 10px 0 0 0;\n  padding: 10px 0 0 0;\n}\n.chart-list-scroll[data-v-3a6161b3] {\n  padding: 0 20px;\n  height: 100%;\n  overflow: auto;\n}\n.chart-empty[data-v-3a6161b3] {\n  color: #aaa;\n  padding: 80px 0;\n  text-align: center;\n}\n.msg-item[data-v-3a6161b3] {\n  position: relative;\n  margin-bottom: 14px;\n}\n.msg-item .user-icon[data-v-3a6161b3] {\n    position: absolute;\n    width: 30px;\n    height: 30px;\n    border: 2px solid #03b349;\n    border-radius: 40px;\n}\n.msg-item .msg-time[data-v-3a6161b3] {\n    line-height: 1.3;\n    color: #aaa;\n}\n.msg-item .msg-text[data-v-3a6161b3] {\n    min-height: 26px;\n    display: inline-block;\n    background: #fff;\n    border: 1px solid #03b349;\n    border-radius: 5px;\n    padding: 0 20px;\n    max-width: 100%;\n    word-break: break-all;\n    text-align: left;\n}\n.msg-item.msg-self .user-icon[data-v-3a6161b3] {\n    right: 0;\n}\n.msg-item.msg-self .msg-content[data-v-3a6161b3] {\n    padding-right: 50px;\n    text-align: right;\n}\n.msg-item.msg-other .user-icon[data-v-3a6161b3] {\n    left: 0;\n}\n.msg-item.msg-other .msg-content[data-v-3a6161b3] {\n    padding-left: 50px;\n}\n.send-msg[data-v-3a6161b3] {\n  position: fixed;\n  bottom: 0;\n  width: 100%;\n  line-height: 2;\n  background: #fbf9fe;\n  padding: 0 0 6px 0;\n}\n.send-msg .send-box[data-v-3a6161b3] {\n    border: 1px solid #eaeaea;\n    border-width: 1px 0;\n    background: #fff;\n    height: 40px;\n    position: relative;\n}\n.send-msg input[data-v-3a6161b3] {\n    height: 40px;\n    width: calc(100% - 80px);\n    font-size: 14px;\n    padding: 0 70px 0 10px;\n    outline: 0;\n    border: 0;\n}\n.send-msg .send-btn[data-v-3a6161b3] {\n    background: #03b349;\n    position: absolute;\n    top: 0;\n    right: 10px;\n    color: #fff;\n    padding: 0px 10px;\n    margin: 8px 0;\n    border-radius: 5px;\n}\n.send-msg .send-btn.btn-disabled[data-v-3a6161b3] {\n      background: #eee;\n      color: #aaa;\n}\n"],sourceRoot:""}])},Yid5:function(t,n,e){"use strict";function s(t){e("eIOx")}Object.defineProperty(n,"__esModule",{value:!0});var i=e("vLgD"),a=e("//Fk"),o=e.n(a),r=e("mvHQ"),d=e.n(r),c=e("Dd8w"),A=e.n(c),u=e("NYxO"),g={name:"chartMixin",data:function(){return{ws:null,otherImg:""}},computed:A()({},Object(u.b)({openid:function(t){return t.user.openid},selfImg:function(t){return t.user.infoObj.teaHeadimgurl||t.user.infoObj.stuHeadimgurl}})),mounted:function(){this.initWebsocket()},watch:{courseId:function(){this.initWebsocket()}},methods:{initWebsocket:function(){if(null===this.ws&&""!==this.courseId){var t="ws://47.93.225.12:8082/socketServer/"+this.openid;this.ws=new WebSocket(t),this.ws.onopen=this.websocketonopen,this.ws.onmessage=this.websocketonmessage,this.ws.onerror=this.websocketonerror,this.ws.onclose=this.websocketclose}},websocketonopen:function(){this.addGroup()},websocketonmessage:function(t){var n=JSON.parse(t.data);"SendToChatGroup"===n.opttype&&this.recSocketMsg(n),console.log(n)},websocketonerror:function(){this.initWebSocket()},websocketsend:function(t){this.ws.send(d()(t))},websocketclose:function(t){console.log("断开连接",t)},addGroup:function(){var t={addusername:this.openid,groupname:this.courseId,opttype:"CreateChatGroup",username:this.openid};this.websocketsend(t)},sendSocketMsg:function(t){var n={content:t,groupname:this.courseId,opttype:"SendToChatGroup",username:this.openid};this.websocketsend(n)},recSocketMsg:function(t){var n=this;console.log(t);var e=t.username===this.openid?"self":"other";console.log(e),new o.a(function(s){n.getInfo(t.username,e,s)}).then(function(){n.sendMsgFn(e,t.content)})},getInfo:function(t,n,e){"self"===n&&""===this.selfImg&&this._getImg(t,"self",e),"other"===n&&""===this.otherImg&&this._getImg(t,"other",e)},_getImg:function(t,n,e){var s=this;Object(i.a)({url:"http://www.zhiheyikaoqin.cn/user/queryUserInfo?openid="+t,method:"get"}).then(function(t){if(e(),0===Number(t.data.code)){var i=t.data.data;console.log("obj",i,n),s[n+"Img"]=i.stuHeadimgurl||i.teaHeadimgurl}},20)}}},l=e("X2Oc"),h=e("8pLc"),m=e("KgXo"),p=(h.a,m.a,{name:"chart",components:{noData:h.a,loading:m.a},mixins:[g],data:function(){return{loading:!0,noCourse:!1,courseName:"",teaName:"",courseTime:"",chartList:[],sendMsg:"",courseId:"",doingList:[],count:0,isEnd:!1}},computed:{btnDisabled:function(){return""===this.sendMsg},teaOpenid:function(){return this.$store.state.user.infoObj.teaOpenid||""},stuOpenid:function(){return this.$store.state.user.infoObj.stuOpenid||""},userType:function(){return this.$store.state.user.userType}},mounted:function(){this.$store.commit("SET_RETURN_TEXT","在线交流"),this.$store.commit("SET_RETURN_URL","/my"),this.getDoingList()},watch:{userType:function(){this.getDoingList()}},methods:{getCourseCount:function(){var t=this;Object(i.a)({url:"http://www.zhiheyikaoqin.cn/course/getCountDown?courseId="+this.courseId,method:"get"}).then(function(n){0===n.data.code&&("end"===n.data.data?t.showEnd():(t.count=Number(n.data.data),t.startCount()))})},checkEnd:function(){var t=this;Object(i.a)({url:"http://www.zhiheyikaoqin.cn/course/onCourseEnd?courseId="+this.courseId,method:"get"}).then(function(n){0===n.data.code&&(n.data.data=!0,t.isEnd=n.data.data,n.data.data?t.showEnd():t.startCount())})},startCount:function(){var t=this;setTimeout(function(){t.checkEnd()},1e3*this.count)},showEnd:function(){this.isEnd=!0,Object(l.b)(this,"课程已结束")},clickSend:function(){this.isEnd||(this.sendSocketMsg(this.sendMsg),this.sendMsgFn("self",this.sendMsg))},sendMsgFn:function(t,n){if(console.log("dd",t,n),""!==n){var e=(new Date).toTimeString().split(" ")[0];this.chartList.push({time:e,role:t,text:n}),this.$nextTick(function(){document.querySelector(".chart-list-scroll").scrollTop=999999}),"self"===t&&(this.sendMsg="")}},getTime:function(t){return t.split(" ")[1].split(":")[0]+":"+t.split(" ")[1].split(":")[1]},getDoingList:function(){var t=this;this.loading=!0;var n="";"teacher"===this.userType?(n="http://www.zhiheyikaoqin.cn/tea/findTeaHistoryCourse",n+="?teaOpenid="+this.teaOpenid+"&page=1&pageSize=1000"):"student"===this.userType&&(n="http://www.zhiheyikaoqin.cn/stu/lookHistory",n+="?stuOpenid="+this.stuOpenid+"&page=1&pageSize=1000"),console.log("dd",n),Object(i.a)({url:n,method:"get"}).then(function(n){console.log("sss",n),t.loading=!1,0===n.data.code&&void 0!==n.data.data?(t.doingList=n.data.data.filter(function(n){return"teacher"===t.userType?302===n.teaCourse.courseStatus:302===n.teaCourse.courseStatus&&401===n.subStatus}).map(function(n){return n.teaCourse.courseTime=n.teaCourse.courseDate.split(" ")[0]+" "+t.getTime(n.teaCourse.courseStartTime)+" - "+t.getTime(n.teaCourse.courseEndTime),n}),0===t.doingList.length?t.noCourse=!0:(t.courseId=t.doingList[0].teaCourse.courseId,t.courseName=t.doingList[0].teaCourse.courseName,t.courseTime=t.doingList[0].teaCourse.courseTime,"student"===t.userType?t.teaName=t.doingList[0].teaName:t.teaName=t.doingList[0].teaBase.teaName,t.noCourse=!1,t.getCourseCount())):t.noCourse=!0})}}}),C=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"doing-course"},[!t.loading&&t.noCourse?e("div",{staticClass:"no-course"},[e("no-data",{attrs:{text:"当前没有正在上的课"}})],1):t._e(),t._v(" "),t.loading||t.noCourse?t._e():e("div",{staticClass:"course-info"},[e("div",{staticClass:"course-name"},[e("label",[t._v("课程名称：")]),t._v(" "),e("span",[t._v(t._s(t.courseName))])]),t._v(" "),e("div",{staticClass:"course-time"},[e("label",[t._v("课程时间：")]),t._v(" "),e("span",[t._v(t._s(t.courseTime))])]),t._v(" "),e("div",{staticClass:"course-time"},[e("label",[t._v("老师姓名：")]),t._v(" "),e("span",[t._v(t._s(t.teaName))])])]),t._v(" "),t.loading||t.noCourse?t._e():e("div",{staticClass:"chart-box"},[e("div",{staticClass:"chart-list-scroll"},[t._l(t.chartList,function(n){return 0!==t.chartList.length?e("div",{staticClass:"chart-list"},["self"===n.role?e("div",{staticClass:"msg-self msg-item"},[e("img",{staticClass:"user-icon",attrs:{src:t.selfImg}}),t._v(" "),e("div",{staticClass:"msg-content"},[e("div",{staticClass:"msg-text"},[t._v(t._s(n.text))]),t._v(" "),e("div",{staticClass:"msg-time"},[t._v(t._s(n.time))])])]):t._e(),t._v(" "),"other"===n.role?e("div",{staticClass:"msg-other msg-item"},[e("img",{staticClass:"user-icon",attrs:{src:t.otherImg}}),t._v(" "),e("div",{staticClass:"msg-content"},[e("div",{staticClass:"msg-text"},[t._v(t._s(n.text))]),t._v(" "),e("div",{staticClass:"msg-time"},[t._v(t._s(n.time))])])]):t._e()]):t._e()}),t._v(" "),0===t.chartList.length?e("div",{staticClass:"chart-list chart-empty"},[t._v("\n        暂无聊天记录\n      ")]):t._e()],2)]),t._v(" "),t.loading||t.noCourse?t._e():e("div",{staticClass:"send-msg"},[e("div",{staticClass:"send-box"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.sendMsg,expression:"sendMsg"}],attrs:{type:"text",disabled:t.isEnd},domProps:{value:t.sendMsg},on:{keyup:function(n){return"button"in n||!t._k(n.keyCode,"enter",13,n.key,"Enter")?t.clickSend(n):null},input:function(n){n.target.composing||(t.sendMsg=n.target.value)}}}),t._v(" "),e("div",{staticClass:"send-btn",class:{"btn-disabled":t.isEnd||t.btnDisabled},on:{click:function(n){return n.stopPropagation(),t.clickSend(n)}}},[t._v("发送")])])]),t._v(" "),t.loading?[e("loading")]:t._e()],2)},b=[],f={render:C,staticRenderFns:b},B=f,v=e("VU/8"),x=s,I=v(p,B,!1,x,"data-v-3a6161b3",null);n.default=I.exports},eIOx:function(t,n,e){var s=e("DaP+");"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);e("rjj0")("63bbf9eb",s,!0,{})}});
//# sourceMappingURL=12.126893ebd50c5a46ddbc.js.map