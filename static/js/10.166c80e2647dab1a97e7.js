webpackJsonp([10],{NXJC:function(e,n,t){var s=t("gXAE");"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);t("rjj0")("04b128e8",s,!0,{})},Yid5:function(e,n,t){"use strict";function s(e){t("NXJC")}Object.defineProperty(n,"__esModule",{value:!0});var i=t("vLgD"),o=t("//Fk"),a=t.n(o),d=t("mvHQ"),r=t.n(d),c=t("Dd8w"),A=t.n(c),g=t("NYxO"),u={name:"chartMixin",data:function(){return{ws:null,otherImg:""}},computed:A()({},Object(g.b)({openid:function(e){return e.user.openid},selfImg:function(e){return e.user.infoObj.teaHeadimgurl||e.user.infoObj.stuHeadimgurl}})),mounted:function(){this.initWebsocket()},watch:{courseId:function(){this.initWebsocket()}},methods:{initWebsocket:function(){if(null===this.ws&&""!==this.courseId){var e="ws://47.93.225.12:8082/socketServer/"+this.openid;this.ws=new WebSocket(e),this.ws.onopen=this.websocketonopen,this.ws.onmessage=this.websocketonmessage,this.ws.onerror=this.websocketonerror,this.ws.onclose=this.websocketclose}},websocketonopen:function(){this.addGroup()},websocketonmessage:function(e){var n=JSON.parse(e.data);"SendToChatGroup"===n.opttype&&this.recSocketMsg(n),console.log(n)},websocketonerror:function(){this.initWebSocket()},websocketsend:function(e){this.ws.send(r()(e))},websocketclose:function(e){console.log("断开连接",e)},addGroup:function(){var e={addusername:this.openid,groupname:this.courseId,opttype:"CreateChatGroup",username:this.openid};this.websocketsend(e)},sendSocketMsg:function(e){var n={content:e,groupname:this.courseId,opttype:"SendToChatGroup",username:this.openid};this.websocketsend(n)},recSocketMsg:function(e){var n=this;console.log(e);var t=e.username===this.openid?"self":"other";console.log(t),new a.a(function(s){n.getInfo(e.username,t,s)}).then(function(){n.sendMsgFn(t,e.content)})},getInfo:function(e,n,t){"self"===n&&""===this.selfImg&&this._getImg(e,"self",t),"other"===n&&""===this.otherImg&&this._getImg(e,"other",t)},_getImg:function(e,n,t){var s=this;Object(i.a)({url:"http://www.zhiheyikaoqin.cn/user/queryUserInfo?openid="+e,method:"get"}).then(function(e){if(t(),0===Number(e.data.code)){var i=e.data.data;console.log("obj",i,n),s[n+"Img"]=i.stuHeadimgurl||i.teaHeadimgurl}},20)}}},l=t("X2Oc"),h=t("8pLc"),m=t("KgXo"),p=(h.a,m.a,{name:"chart",components:{noData:h.a,loading:m.a},mixins:[u],data:function(){return{loading:!0,noCourse:!1,courseName:"",teaName:"",courseTime:"",chartList:[],sendMsg:"",courseId:"",doingList:[],count:0,isEnd:!1}},computed:{btnDisabled:function(){return""===this.sendMsg},teaOpenid:function(){return this.$store.state.user.infoObj.teaOpenid||""},stuOpenid:function(){return this.$store.state.user.infoObj.stuOpenid||""},userType:function(){return this.$store.state.user.userType}},mounted:function(){this.$store.commit("SET_RETURN_TEXT","在线交流"),this.$store.commit("SET_RETURN_URL","/my"),this.getDoingList()},watch:{userType:function(){this.getDoingList()}},methods:{getCourseCount:function(){var e=this;Object(i.a)({url:"http://www.zhiheyikaoqin.cn/course/getCountDown?courseId="+this.courseId,method:"get"}).then(function(n){0===n.data.code&&("end"===n.data.data?e.showEnd():(e.count=Number(n.data.data),e.startCount()))})},checkEnd:function(){var e=this;Object(i.a)({url:"http://www.zhiheyikaoqin.cn/course/onCourseEnd?courseId="+this.courseId,method:"get"}).then(function(n){0===n.data.code&&(n.data.data=!0,e.isEnd=n.data.data,n.data.data?e.showEnd():e.startCount())})},startCount:function(){var e=this;setTimeout(function(){e.checkEnd()},1e3*this.count)},showEnd:function(){this.isEnd=!0,Object(l.b)(this,"课程已结束")},clickSend:function(){this.isEnd||(this.sendSocketMsg(this.sendMsg),this.sendMsgFn("self",this.sendMsg))},sendMsgFn:function(e,n){if(console.log("dd",e,n),""!==n){var t=(new Date).toTimeString().split(" ")[0];this.chartList.push({time:t,role:e,text:n}),this.$nextTick(function(){document.querySelector(".chart-list-scroll").scrollTop=999999}),"self"===e&&(this.sendMsg="")}},getTime:function(e){return e.split(" ")[1].split(":")[0]+":"+e.split(" ")[1].split(":")[1]},getDoingList:function(){var e=this;this.loading=!0;var n="";"teacher"===this.userType?(n="http://www.zhiheyikaoqin.cn/tea/findTeaHistoryCourse",n+="?teaOpenid="+this.teaOpenid+"&page=1&pageSize=1000"):"student"===this.userType&&(n="http://www.zhiheyikaoqin.cn/stu/lookHistory",n+="?stuOpenid="+this.stuOpenid+"&page=1&pageSize=1000"),console.log("dd",n),Object(i.a)({url:n,method:"get"}).then(function(n){console.log("sss",n),e.loading=!1,0===n.data.code&&void 0!==n.data.data?(e.doingList=n.data.data.filter(function(e){return 302===e.teaCourse.courseStatus}).map(function(n){return n.teaCourse.courseTime=n.teaCourse.courseDate.split(" ")[0]+" "+e.getTime(n.teaCourse.courseStartTime)+" - "+e.getTime(n.teaCourse.courseEndTime),n}),0===e.doingList.length?e.noCourse=!0:(e.courseId=e.doingList[0].teaCourse.courseId,e.courseName=e.doingList[0].teaCourse.courseName,e.courseTime=e.doingList[0].teaCourse.courseTime,"student"===e.userType?e.teaName=e.doingList[0].teaName:e.teaName=e.doingList[0].teaBase.teaName,e.getCourseCount())):e.noCourse=!0})}}}),C=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",{staticClass:"doing-course"},[!e.loading&&e.noCourse?t("div",{staticClass:"no-course"},[t("no-data",{attrs:{text:"当前没有正在上的课"}})],1):e._e(),e._v(" "),e.loading||e.noCourse?e._e():t("div",{staticClass:"course-info"},[t("div",{staticClass:"course-name"},[t("label",[e._v("课程名称：")]),e._v(" "),t("span",[e._v(e._s(e.courseName))])]),e._v(" "),t("div",{staticClass:"course-time"},[t("label",[e._v("课程时间：")]),e._v(" "),t("span",[e._v(e._s(e.courseTime))])]),e._v(" "),t("div",{staticClass:"course-time"},[t("label",[e._v("老师姓名：")]),e._v(" "),t("span",[e._v(e._s(e.teaName))])])]),e._v(" "),e.loading||e.noCourse?e._e():t("div",{staticClass:"chart-box"},[t("div",{staticClass:"chart-list-scroll"},[e._l(e.chartList,function(n){return 0!==e.chartList.length?t("div",{staticClass:"chart-list"},["self"===n.role?t("div",{staticClass:"msg-self msg-item"},[t("img",{staticClass:"user-icon",attrs:{src:e.selfImg}}),e._v(" "),t("div",{staticClass:"msg-content"},[t("div",{staticClass:"msg-text"},[e._v(e._s(n.text))]),e._v(" "),t("div",{staticClass:"msg-time"},[e._v(e._s(n.time))])])]):e._e(),e._v(" "),"other"===n.role?t("div",{staticClass:"msg-other msg-item"},[t("img",{staticClass:"user-icon",attrs:{src:e.otherImg}}),e._v(" "),t("div",{staticClass:"msg-content"},[t("div",{staticClass:"msg-text"},[e._v(e._s(n.text))]),e._v(" "),t("div",{staticClass:"msg-time"},[e._v(e._s(n.time))])])]):e._e()]):e._e()}),e._v(" "),0===e.chartList.length?t("div",{staticClass:"chart-list chart-empty"},[e._v("\n        暂无聊天记录\n      ")]):e._e()],2)]),e._v(" "),e.loading||e.noCourse?e._e():t("div",{staticClass:"send-msg"},[t("div",{staticClass:"send-box"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.sendMsg,expression:"sendMsg"}],attrs:{type:"text",disabled:e.isEnd},domProps:{value:e.sendMsg},on:{keyup:function(n){return"button"in n||!e._k(n.keyCode,"enter",13,n.key,"Enter")?e.clickSend(n):null},input:function(n){n.target.composing||(e.sendMsg=n.target.value)}}}),e._v(" "),t("div",{staticClass:"send-btn",class:{"btn-disabled":e.isEnd||e.btnDisabled},on:{click:function(n){return n.stopPropagation(),e.clickSend(n)}}},[e._v("发送")])])]),e._v(" "),e.loading?[t("loading")]:e._e()],2)},b=[],f={render:C,staticRenderFns:b},B=f,v=t("VU/8"),x=s,I=v(p,B,!1,x,"data-v-6e7b4350",null);n.default=I.exports},gXAE:function(e,n,t){n=e.exports=t("FZ+f")(!0),n.push([e.i,"\n.green[data-v-6e7b4350] {\n  color: #03b349;\n}\n.doing-course[data-v-6e7b4350] {\n  padding-bottom: 50px;\n}\n.course-info[data-v-6e7b4350] {\n  line-height: 2;\n  margin: 10px 0;\n  background: #fff;\n  padding: 10px 20px;\n}\n.chart-box[data-v-6e7b4350] {\n  height: calc(100% - 120px);\n  overflow: hidden;\n  line-height: 2;\n  margin: 10px 0 0 0;\n  padding: 10px 0 0 0;\n}\n.chart-list-scroll[data-v-6e7b4350] {\n  padding: 0 20px;\n  height: 100%;\n  overflow: auto;\n}\n.chart-empty[data-v-6e7b4350] {\n  color: #aaa;\n  padding: 80px 0;\n  text-align: center;\n}\n.msg-item[data-v-6e7b4350] {\n  position: relative;\n  margin-bottom: 14px;\n}\n.msg-item .user-icon[data-v-6e7b4350] {\n    position: absolute;\n    width: 30px;\n    height: 30px;\n    border: 2px solid #03b349;\n    border-radius: 40px;\n}\n.msg-item .msg-time[data-v-6e7b4350] {\n    line-height: 1.3;\n    color: #aaa;\n}\n.msg-item .msg-text[data-v-6e7b4350] {\n    min-height: 26px;\n    display: inline-block;\n    background: #fff;\n    border: 1px solid #03b349;\n    border-radius: 5px;\n    padding: 0 20px;\n    max-width: 100%;\n    word-break: break-all;\n    text-align: left;\n}\n.msg-item.msg-self .user-icon[data-v-6e7b4350] {\n    right: 0;\n}\n.msg-item.msg-self .msg-content[data-v-6e7b4350] {\n    padding-right: 50px;\n    text-align: right;\n}\n.msg-item.msg-other .user-icon[data-v-6e7b4350] {\n    left: 0;\n}\n.msg-item.msg-other .msg-content[data-v-6e7b4350] {\n    padding-left: 50px;\n}\n.send-msg[data-v-6e7b4350] {\n  position: fixed;\n  bottom: 0;\n  width: 100%;\n  line-height: 2;\n  background: #fbf9fe;\n  padding: 0 0 6px 0;\n}\n.send-msg .send-box[data-v-6e7b4350] {\n    border: 1px solid #eaeaea;\n    border-width: 1px 0;\n    background: #fff;\n    height: 40px;\n    position: relative;\n}\n.send-msg input[data-v-6e7b4350] {\n    height: 40px;\n    width: calc(100% - 80px);\n    font-size: 14px;\n    padding: 0 70px 0 10px;\n    outline: 0;\n    border: 0;\n}\n.send-msg .send-btn[data-v-6e7b4350] {\n    background: #03b349;\n    position: absolute;\n    top: 0;\n    right: 10px;\n    color: #fff;\n    padding: 0px 10px;\n    margin: 8px 0;\n    border-radius: 5px;\n}\n.send-msg .send-btn.btn-disabled[data-v-6e7b4350] {\n      background: #eee;\n      color: #aaa;\n}\n","",{version:3,sources:["/Users/lh/work/zk/fe/src/chart/index.vue"],names:[],mappings:";AACA;EACE,eAAe;CAChB;AACD;EACE,qBAAqB;CACtB;AACD;EACE,eAAe;EACf,eAAe;EACf,iBAAiB;EACjB,mBAAmB;CACpB;AACD;EACE,2BAA2B;EAC3B,iBAAiB;EACjB,eAAe;EACf,mBAAmB;EACnB,oBAAoB;CACrB;AACD;EACE,gBAAgB;EAChB,aAAa;EACb,eAAe;CAChB;AACD;EACE,YAAY;EACZ,gBAAgB;EAChB,mBAAmB;CACpB;AACD;EACE,mBAAmB;EACnB,oBAAoB;CACrB;AACD;IACI,mBAAmB;IACnB,YAAY;IACZ,aAAa;IACb,0BAA0B;IAC1B,oBAAoB;CACvB;AACD;IACI,iBAAiB;IACjB,YAAY;CACf;AACD;IACI,iBAAiB;IACjB,sBAAsB;IACtB,iBAAiB;IACjB,0BAA0B;IAC1B,mBAAmB;IACnB,gBAAgB;IAChB,gBAAgB;IAChB,sBAAsB;IACtB,iBAAiB;CACpB;AACD;IACI,SAAS;CACZ;AACD;IACI,oBAAoB;IACpB,kBAAkB;CACrB;AACD;IACI,QAAQ;CACX;AACD;IACI,mBAAmB;CACtB;AACD;EACE,gBAAgB;EAChB,UAAU;EACV,YAAY;EACZ,eAAe;EACf,oBAAoB;EACpB,mBAAmB;CACpB;AACD;IACI,0BAA0B;IAC1B,oBAAoB;IACpB,iBAAiB;IACjB,aAAa;IACb,mBAAmB;CACtB;AACD;IACI,aAAa;IACb,yBAAyB;IACzB,gBAAgB;IAChB,uBAAuB;IACvB,WAAW;IACX,UAAU;CACb;AACD;IACI,oBAAoB;IACpB,mBAAmB;IACnB,OAAO;IACP,YAAY;IACZ,YAAY;IACZ,kBAAkB;IAClB,cAAc;IACd,mBAAmB;CACtB;AACD;MACM,iBAAiB;MACjB,YAAY;CACjB",file:"index.vue",sourcesContent:["\n.green[data-v-6e7b4350] {\n  color: #03b349;\n}\n.doing-course[data-v-6e7b4350] {\n  padding-bottom: 50px;\n}\n.course-info[data-v-6e7b4350] {\n  line-height: 2;\n  margin: 10px 0;\n  background: #fff;\n  padding: 10px 20px;\n}\n.chart-box[data-v-6e7b4350] {\n  height: calc(100% - 120px);\n  overflow: hidden;\n  line-height: 2;\n  margin: 10px 0 0 0;\n  padding: 10px 0 0 0;\n}\n.chart-list-scroll[data-v-6e7b4350] {\n  padding: 0 20px;\n  height: 100%;\n  overflow: auto;\n}\n.chart-empty[data-v-6e7b4350] {\n  color: #aaa;\n  padding: 80px 0;\n  text-align: center;\n}\n.msg-item[data-v-6e7b4350] {\n  position: relative;\n  margin-bottom: 14px;\n}\n.msg-item .user-icon[data-v-6e7b4350] {\n    position: absolute;\n    width: 30px;\n    height: 30px;\n    border: 2px solid #03b349;\n    border-radius: 40px;\n}\n.msg-item .msg-time[data-v-6e7b4350] {\n    line-height: 1.3;\n    color: #aaa;\n}\n.msg-item .msg-text[data-v-6e7b4350] {\n    min-height: 26px;\n    display: inline-block;\n    background: #fff;\n    border: 1px solid #03b349;\n    border-radius: 5px;\n    padding: 0 20px;\n    max-width: 100%;\n    word-break: break-all;\n    text-align: left;\n}\n.msg-item.msg-self .user-icon[data-v-6e7b4350] {\n    right: 0;\n}\n.msg-item.msg-self .msg-content[data-v-6e7b4350] {\n    padding-right: 50px;\n    text-align: right;\n}\n.msg-item.msg-other .user-icon[data-v-6e7b4350] {\n    left: 0;\n}\n.msg-item.msg-other .msg-content[data-v-6e7b4350] {\n    padding-left: 50px;\n}\n.send-msg[data-v-6e7b4350] {\n  position: fixed;\n  bottom: 0;\n  width: 100%;\n  line-height: 2;\n  background: #fbf9fe;\n  padding: 0 0 6px 0;\n}\n.send-msg .send-box[data-v-6e7b4350] {\n    border: 1px solid #eaeaea;\n    border-width: 1px 0;\n    background: #fff;\n    height: 40px;\n    position: relative;\n}\n.send-msg input[data-v-6e7b4350] {\n    height: 40px;\n    width: calc(100% - 80px);\n    font-size: 14px;\n    padding: 0 70px 0 10px;\n    outline: 0;\n    border: 0;\n}\n.send-msg .send-btn[data-v-6e7b4350] {\n    background: #03b349;\n    position: absolute;\n    top: 0;\n    right: 10px;\n    color: #fff;\n    padding: 0px 10px;\n    margin: 8px 0;\n    border-radius: 5px;\n}\n.send-msg .send-btn.btn-disabled[data-v-6e7b4350] {\n      background: #eee;\n      color: #aaa;\n}\n"],sourceRoot:""}])}});
//# sourceMappingURL=10.166c80e2647dab1a97e7.js.map